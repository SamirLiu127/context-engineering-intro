### 🔄 項目意識和上下文
- **在新對話開始時始終閱讀 `PLANNING.md`**，以了解項目的架構、目標、風格和約束。
- **在開始新任務之前檢查 `TASK.md`**。如果任務未列出，請添加簡要描述和今天的日期。
- **使用 `PLANNING.md` 中描述的一致命名約定、文件結構和架構模式**。
- **使用 Go modules 管理依賴項**，確保可重現的構建環境。

### 🧱 代碼結構和模組化
- **永遠不要創建超過 500 行代碼的文件。** 如果文件接近此限制，請通過將其拆分為模組或輔助文件來重構。
- **將代碼組織成清晰分離的模組**，按功能或職責分組。
- **使用清晰的套件結構**，遵循 Go 的套件命名慣例。
- **使用環境變量或配置文件** 管理敏感配置，可使用 `github.com/joho/godotenv` 載入 .env 文件。
- **善用 context.Context** 進行請求追蹤、逾時控制和取消操作。

### 🔧 技術約束和最佳實踐
- **爬蟲架構設計**：
  - 使用非同步爬蟲架構，支持大規模並發抓取
  - 實施智能重試機制，處理API限制和網絡錯誤
  - 設計可配置的抓取策略，支持不同類型內容的差異化處理
  - 建立完整的錯誤處理和日誌記錄系統
- **數據存儲策略**：
  - 使用 PostgreSQL 存儲結構化數據（頻道、影片、留言元數據）
  - 設計高效的數據庫架構，支持大量數據的寫入和查詢
  - 實施數據去重機制，避免重複存儲
  - 使用適當的索引策略優化查詢性能
- **任務調度和監控**：
  - 使用 Celery + Redis 管理非同步爬蟲任務
  - 實施任務優先級管理，根據PRD需求調整抓取順序
  - 建立完整的監控指標：配額使用率、抓取成功率、數據完整性

### 🧪 測試和可靠性
- **爬蟲測試重點**：
  - YouTube API 客戶端功能測試
  - 配額管理機制測試  
  - 數據解析和驗證測試
  - 錯誤處理和重試邏輯測試
- **數據完整性測試**：
  - 數據模型驗證測試
  - 數據庫寫入和讀取測試
  - 數據去重機制測試
  - 數據一致性檢查
- **性能和穩定性測試**：
  - 大量數據抓取壓力測試
  - 配額限制下的行為測試
  - 長時間運行穩定性測試
- **測試應位於 `/tests` 文件夾中**，鏡像主應用程序結構。
  - 至少包括：
    - 1 個預期使用測試
    - 1 個邊緣情況（如配額耗盡）
    - 1 個失敗情況（如API錯誤）
    - 集成測試（端到端爬蟲流程）
    - 性能基準測試

### ✅ 任務完成
- **完成任務後立即在 `TASK.md` 中標記已完成的任務**。
- 將開發過程中發現的新子任務或待辦事項添加到 `TASK.md` 的"工作中發現"部分。
- **記錄爬蟲執行狀態**：API 配額使用情況、數據抓取統計、性能指標。
- **維護數據品質報告**：定期檢查數據完整性和準確性。

### 📎 風格和約定
- **Python**
  - 使用 Python 作為主要語言。
  - 遵循 PEP8，使用型別提示，並使用 black 進行格式化。
  - 使用 pydantic 進行資料驗證。
  - 如有需要，API 請使用 FastAPI，ORM 請使用 SQLAlchemy 或 SQLModel。
  - 每個函式請使用 Google 風格撰寫文件字串（docstring）：
    ```python
      def example():
      """
      簡要摘要。

      Args:
          param1 (type): 描述。

      Returns:
          type: 描述。
      """
    ```
- **Golang**
  - **使用 Go** 作為主要語言構建高效能爬蟲系統。
  - **遵循 Go 標準**：使用 `go fmt`、`go vet` 和 `golint` 確保代碼品質。
  - **使用結構體和介面**進行數據建模和抽象化設計。
  - **善用 Go 的並發特性**：使用 goroutines 和 channels 實現高效並發爬蟲。
  - **使用適當的 Go 套件**：
    - `net/http` 進行 HTTP 請求
    - `encoding/json` 處理 JSON 數據
    - `database/sql` 配合相應驅動程式進行資料庫操作
    - `github.com/go-redis/redis` 進行 Redis 操作
    - `github.com/robfig/cron` 實現任務調度
  - **為每個公開函數編寫清晰的註釋**：
    ```go
    // FetchChannelData 從 YouTube API 獲取頻道數據
    // channelID: YouTube 頻道 ID
    // 返回頻道數據和可能的錯誤
    func FetchChannelData(channelID string) (*Channel, error) {
        // 實現細節...
    }
    ```

### 📚 文檔和可解釋性
- **在添加新功能、依賴項更改或修改設置步驟時更新 `README.md`**。
- **維護爬蟲配置文檔**，說明不同抓取策略的參數和效果。
- 編寫複雜邏輯時，**添加內聯註釋**，解釋為什麼這樣設計，而不僅僅是做什麼。

### 🧠 AI 行為規則
- **永遠不要假設缺失的上下文。如果不確定，請提出問題。**
- **永遠不要臆造庫或函數** – 僅使用已知的、經過驗證的 Go 套件。
- **在代碼或測試中引用文件路徑和套件名稱之前，始終確認它們存在**。
- **永遠不要刪除或覆蓋現有代碼**，除非明確指示或作為 `TASK.md` 中任務的一部分。
- **優先考慮 API 配額效率**：每個功能都應該考慮其對 YouTube API 配額的影響。
- **善用 Go 的特性**：適當使用 goroutines、channels、context 進行並發控制和資源管理。

### 🚀 性能和擴展性
- **善用 Go 的並發優勢**：使用 goroutines 實現高效並發爬蟲，但要控制並發數量避免配額耗盡。
- **實施智能快取策略**：使用 Redis 快取 API 回應，減少重複調用。
- **設計可擴展架構**：支持水平擴展和多實例部署。
- **監控關鍵指標**：API 響應時間、配額使用率、爬蟲成功率、數據完整性。
- **優化資源使用**：合理配置 goroutine 池大小和記憶體使用，避免資源浪費。
- **實施熔斷機制**：在 API 限制或錯誤達到閾值時自動停止，保護系統穩定性。